<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>La Forteresse – Proto simple</title>
<style>
  :root { --grid: 9; }
  html, body {
    height:100%; margin:0; background:#111; color:#eee;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  }
  .wrap { max-width: 92vmin; margin: 24px auto; }
  #board {
    position: relative;
    width: 100%;
    aspect-ratio: 1 / 1;
    background: url('plateau12.png') center/cover no-repeat;
    border: 2px solid #fff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,.4);
    user-select: none;
  }
  /* calque des cases (81 divs) */
  #cells {
    position:absolute; inset:0;
    display:grid;
    grid-template-columns: repeat(9, 1fr);
    grid-template-rows: repeat(9, 1fr);
  }
  .cell {
    border: 1px solid rgba(255,255,255,.28); /* lignes visibles */
    box-sizing: border-box;
  }
  /* calque clics + surbrillance */
  #hit { position:absolute; inset:0; cursor:pointer; }
  #highlight {
    position:absolute; border:2px solid rgba(255,255,255,.85);
    pointer-events:none; display:none;
    transform: translate(-1px,-1px); /* compense la bordure */
  }
  .log {
    margin-top:10px; background:#1a1f2c; border:1px solid #2a3142;
    padding:10px; border-radius:10px; font-size:14px;
    min-height: 36px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <div id="board">
      <div id="cells"></div>
      <div id="hit" aria-label="zone interactive"></div>
      <div id="highlight"></div>
    </div>
    <div class="log" id="log">Clique sur une case pour voir ses coordonnées (A1…I9).</div>
  </div>

<script>
  const GRID = 9;
  const COLS = "ABCDEFGHI";

  const board = document.getElementById('board');
  const cells = document.getElementById('cells');
  const hit = document.getElementById('hit');
  const highlight = document.getElementById('highlight');
  const logEl = document.getElementById('log');

// --- Définition des cases valides / zones spéciales ---
const validCells = new Set([
  "A4","A5","A6","A7","A8",
  "B4","B5","B6","B7","B8","B9",
  "C3","C4","C5","C6","C7","C8","C9",
  "D1","D2","D3","D4","D5","D6","D7","D8","D9",
  "E1","E2","E3","E4","E5","E6","E7","E8","E9",
  "F1","F2","F3","F4","F5","F6","F7","F8","F9",
  "G1","G2","G3","G4","G5","G6","G7",
  "H1","H2","H3","H4","H5","H6",
  "I2","I3","I4","I5","I6"
]);

const orangeZone = new Set(["D5","E4","E5","E6","F5"]);

const redFortress = "I1";
const blueFortress = "A9";

const redStart = new Set(["G1","G2","G3","H1","H2","H3","I2","I3"]);
const blueStart = new Set(["A8","A7","B9","B8","B7","C9","C8","C7"]);
 
function buildGrid(){
  cells.innerHTML = "";
  for(let r=GRID-1; r>=0; r--){ // haut → bas
    for(let c=0; c<GRID; c++){
      const alg = toAlg(c,r);

      // ❌ Si la case n'est pas valide ET pas une forteresse → on saute
      if(!validCells.has(alg) && alg !== redFortress && alg !== blueFortress){
        continue;
      }

      const d = document.createElement('div');
      d.className = 'cell';

      // 🟧 zone centrale
      if(orangeZone.has(alg)){
        d.style.background = "rgba(255,140,0,0.3)";
      }
      // 🔴 départ rouge
      if(redStart.has(alg)){
        d.style.background = "rgba(255,0,0,0.3)";
      }
      // 🔵 départ bleu
      if(blueStart.has(alg)){
        d.style.background = "rgba(0,0,255,0.3)";
      }
      // 🏰 forteresse
      if(alg === redFortress){
        d.style.background = "rgba(255,0,0,0.6)";
      }
      if(alg === blueFortress){
        d.style.background = "rgba(0,0,255,0.6)";
      }

      cells.appendChild(d);
    }
  }
}

  // 2) Helpers coordonnées
  function toAlg(c,r){ return COLS[c] + (r+1); } // (0,0)->A1, (8,8)->I9

  function cellFromEvent(e){
    const rect = board.getBoundingClientRect();
    const size = rect.width;               // carré
    const cell = size / GRID;
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    let c = Math.floor(x / cell);          // 0..8 (gauche->droite)
    let rTop = Math.floor(y / cell);       // 0..8 (haut->bas)
    let r = (GRID-1) - rTop;               // 0..8 (bas->haut  = rangée 1..9)

    // clamp
    c = Math.max(0, Math.min(GRID-1, c));
    r = Math.max(0, Math.min(GRID-1, r));

    return { c, r, cell, rect };
  }

  function placeHighlight(c,r, cell){
    // convertir r (0=bas) en coord écran (0=haut)
    const yTop = (GRID-1 - r) * cell;
    const x = c * cell;
    highlight.style.left = x + "px";
    highlight.style.top  = yTop + "px";
    highlight.style.width  = cell + "px";
    highlight.style.height = cell + "px";
    highlight.style.display = "block";
  }

  // 3) Interactions
  hit.addEventListener('mousemove', (e)=>{
    const {c,r,cell} = cellFromEvent(e);
    placeHighlight(c,r,cell);
  });
  hit.addEventListener('mouseleave', ()=>{
    highlight.style.display = "none";
  });
hit.addEventListener('click', (e)=>{
  const {c,r} = cellFromEvent(e);
  const alg = toAlg(c,r);

  if(!validCells.has(alg)){
    logEl.textContent = alg + " ❌ Case interdite";
    return;
  }

  logEl.textContent = "✅ Clic sur " + alg;
});

  // 4) Init + ajuster si redimensionnement
  buildGrid();
  window.addEventListener('resize', ()=>{
    // on cache la surbrillance pour éviter un décalage visuel pendant le resize
    highlight.style.display = "none";
  });
</script>
</body>
</html>
